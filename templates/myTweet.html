<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>timeline</title>
    <script src="/static/jquery-3.0.0.min.js"></script>
    <script>
        var bindDeleteAction = function() {
            $('.button-delete').on('click', function () {
                var self = $(this);
                var tweet_id = this.dataset.id;
                var tweet_name = this.dataset.name;
                console.log('tid', tweet_id);
                console.log('tname', tweet_name);

                var requset = {
                    url: '/tweet/delete/' + tweet_id,
                    type: 'get',
                    contentType: 'application/json',
                    success: function (r) {
                        console.log(r);
                        if (r.success) {
                            self.parent().remove();
                        }
                    },
                    error: function () {
                        console.log(r);
                    }
                };
                $.ajax(requset);
            });
        };


        var bindAddTweetAction = function () {
            $('#id-button-add').on('click', function () {
                var self = $(this);
                var content = $('#id-input-content').val();
                var form = {
                    'content': content
                };
                console.log('form', form);

                var data = JSON.stringify(form);
                console.log('data', data);
                var request = {
                    url: '/tweet/add',
                    type: 'post',
                    data: data,
                    contentType: 'application/json',
                    success: function (r) {
                        console.log(r);
                        if (r.success) {
{#                            self.parent().remove();#}
                            console.log(r);
                        }
                    },
                    error: function () {
                        console.log(r);
                    }
                };
                $.ajax(request);
            });
        };

        $(document).ready(function(){
            bindDeleteAction();
            bindAddTweetAction();
        });
    </script>
</head>
<body>
    <P>
        您的用户名：{{ user.username }}
        关注用户：0
        粉丝：0
        <a href="/timeline/{{ user.username }}">我的微博</a>
    </P>
{#    <form action="/weibo/add/{{user.username}}" method="POST">#}
        <textarea id="id-input-content" name="content" placeholder="写点东西"></textarea>
        <br>
        <button id="id-button-add">添加微博</button>
{#    </form>#}
    {% for t in all_tweets %}
    <p>
{#        <a href="/timeline/{{ t.user.username }}">{{ t.user.username }}</a>：#}
        {{ t.content }} : {{ t.created_time }}
        <a href="tweet/update/{{ t.id }}">编辑</a>
        <button class="button-delete" data-id="{{ t.id }}" data-name="gua">删除</button>
    </p>
{#    <a href="/timeline/comments/{{ t.id }}">评论({{ t.comments|length }})</a>#}
    {% endfor %}
{#    <hr>#}
{#    <a href="/tweet/add/{{ user.username }}">返回首页</a>#}
</body>
</html>